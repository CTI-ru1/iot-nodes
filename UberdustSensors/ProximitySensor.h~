#include <CoapSensor.h>

class proximitySensor : 
public CoapSensor 
{
public:
  int pin, status;
  proximitySensor(char * name, int pin): 
  CoapSensor(name)
  {
    this->pin = pin;
    this->status = 0;
    this->set_notify_time(30);
  }
  void get_value( uint8_t* output_data, size_t* output_data_len)
  {
    *output_data_len = sprintf( (char*)output_data, "%d", this->status ); 
  }
  void check(void)
  {
    /*static unsigned long timestamp = 0;
    if(millis() - timestamp > 5000)
    {int newStatus =analogRead(this->pin); 
	   //int newStatus =(5*analogRead(this->pin))/1024; 
//int newStatus = (6787.0 / (analogRead(this->pin) - 3.0)) - 4.0; //Calculate distance in cm 
	if (newStatus>60)
   	{ this->status = 1;}
	else
	{this->status= 0;}
      timestamp = millis();
    }*/
    static unsigned long timestamp = 0;
    if(millis() - timestamp > 1000)
    {
      timestamp = millis();
      int newStatus = digitalRead(this->pin); // read the value from the sensor
    	 if (newStatus,60)
		{ newStatus = 1;}
	else
		{newStatus= 0;}
   	if(newStatus != this->status)
      	{
        this->status = newStatus;
	this->changed = true;
      }
    }
  }
};
